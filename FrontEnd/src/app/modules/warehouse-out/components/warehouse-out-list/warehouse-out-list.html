<div class="min-h-screen bg-neutral-light dark:bg-dark-background text-text-dark dark:text-dark-text font-sans p-4 sm:p-6 lg:p-8">
  <main class="max-w-7xl mx-auto">

    <header class="flex flex-col sm:flex-row justify-between sm:items-center mb-8 animate-fade-in-down">
      <div>
        <h1 class="text-3xl font-bold text-accent-green dark:text-dark-green">Control de Salidas</h1>
        <p class="text-gray-500 dark:text-gray-400 mt-1">Registro y seguimiento de movimientos de inventario.</p>
      </div>
      <a routerLink="new" class="mt-4 sm:mt-0 flex items-center justify-center gap-2 bg-primary dark:bg-dark-primary text-white dark:text-dark-background font-bold py-2 px-6 rounded-lg shadow-lg hover:bg-primary-hover dark:hover:bg-primary transition-all duration-300 transform hover:-translate-y-1 hover:shadow-2xl focus:outline-none focus:ring-4 focus:ring-primary/50">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" /></svg>
        <span>Registrar Salida</span>
      </a>
    </header>

    <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="metric-card animate-staggered-entry" style="--delay: 150ms;">
        <div class="p-3 bg-primary/20 rounded-lg text-primary"><i class="fas fa-calendar-day h-6 w-6"></i></div>
        <div>
          <p class="text-sm text-gray-500 dark:text-gray-400">Salidas (Hoy)</p>
          <p class="text-2xl font-bold">{{ totalDispatchesToday }}</p>
        </div>
      </div>
      <div class="metric-card animate-staggered-entry" style="--delay: 250ms;">
        <div class="p-3 bg-secondary/30 rounded-lg text-text-dark"><i class="fas fa-box h-6 w-6"></i></div>
        <div>
          <p class="text-sm text-gray-500 dark:text-gray-400">Unidades Despachadas (Hoy)</p>
          <p class="text-2xl font-bold">{{ itemsDispatchedToday }}</p>
        </div>
      </div>
      <div class="metric-card animate-staggered-entry" style="--delay: 350ms;">
        <div class="p-3 bg-accent-red/20 rounded-lg text-accent-red"><i class="fas fa-truck-loading h-6 w-6"></i></div>
        <div>
          <p class="text-sm text-gray-500 dark:text-gray-400">En Tránsito / Pendientes</p>
          <p class="text-2xl font-bold">{{ pendingOrTransitCount }}</p>
        </div>
      </div>
    </section>

    <div class="bg-white/50 dark:bg-dark-background/50 backdrop-blur-xl border border-gray-200/50 dark:border-gray-700/50 rounded-2xl shadow-xl overflow-hidden animate-staggered-entry" style="--delay: 450ms;">
      <div class="px-6 pt-4 border-b border-gray-200/50 dark:border-gray-700/50">
        <nav class="-mb-px flex space-x-6" aria-label="Tabs">
          <a href="#" (click)="$event.preventDefault(); setActiveTab('all')" class="tab-link" [ngClass]="{'active': activeTab === 'all'}">Todos</a>
          <a href="#" (click)="$event.preventDefault(); setActiveTab('transit')" class="tab-link" [ngClass]="{'active': activeTab === 'transit'}">En Tránsito y Pendientes</a>
          <a href="#" (click)="$event.preventDefault(); setActiveTab('completed')" class="tab-link" [ngClass]="{'active': activeTab === 'completed'}">Completados</a>
        </nav>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full text-left">
          <thead class="bg-gray-100/50 dark:bg-white/5">
            <tr class="border-b border-gray-200/50 dark:border-gray-700/50">
              <th class="table-header">Fecha y Hora</th>
              <th class="table-header">Producto</th>
              <th class="table-header">Cantidad</th>
              <th class="table-header">Destino</th>
              <th class="table-header">Estado</th>
              <th class="table-header text-right">Acciones</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200/50 dark:divide-gray-700/50">
            <tr *ngFor="let dispatch of filteredDispatches" class="table-row group">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium">{{ dispatch.date | date:'dd/MM/yyyy' }}</div>
                <div class="text-xs text-gray-500">{{ dispatch.date | date:'shortTime' }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium">{{ dispatch.product.name }}</div>
                <div class="text-xs text-gray-500">{{ dispatch.product.id }} - {{ dispatch.product.category }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-accent-green dark:text-dark-green">{{ dispatch.quantity }} <span class="font-normal text-xs text-gray-500">unid.</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ dispatch.destination }}</td>
              <td class="px-6 py-4 whitespace-nowrap"><span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full" [ngClass]="getStatusColor(dispatch.status)">{{ dispatch.status }}</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <button (click)="openModal(dispatch)" class="text-primary dark:text-dark-primary font-bold py-2 px-4 rounded-lg hover:bg-primary/10 dark:hover:bg-dark-primary/20 transition-colors duration-300">
                  Ver Detalles
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <div *ngIf="isModalOpen" class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fade-in">
    <div (click)="closeModal()" class="absolute inset-0 bg-black/50 dark:bg-black/70 backdrop-blur-sm"></div>
    <div *ngIf="selectedDispatch" class="relative w-full max-w-lg bg-neutral-light/80 dark:bg-dark-background/80 backdrop-blur-2xl border border-gray-200/50 dark:border-gray-700/50 rounded-2xl shadow-2xl p-8 animate-slide-in-up">
      <button (click)="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-accent-red dark:hover:text-dark-red transition-colors duration-300">
        <i class="fas fa-times h-6 w-6"></i>
      </button>
      <div class="flex flex-col items-center text-center">
        <div class="p-4 bg-primary/20 rounded-lg text-primary mb-4"><i class="fas fa-box-open h-8 w-8"></i></div>
        <h2 class="text-2xl font-bold text-accent-green dark:text-dark-green">Detalle de Salida #{{ selectedDispatch.id }}</h2>
        <p class="text-sm text-gray-500 mb-6">{{ selectedDispatch.date | date:'full' }}</p>
        <div class="w-full text-left bg-white/50 dark:bg-white/5 p-4 rounded-lg space-y-3">
          <p><strong>Producto:</strong> {{ selectedDispatch.product.name }} ({{ selectedDispatch.product.id }})</p>
          <p><strong>Cantidad:</strong> <span class="font-bold text-lg">{{ selectedDispatch.quantity }}</span> unidades</p>
          <p><strong>Destino:</strong> {{ selectedDispatch.destination }}</p>
          <p><strong>Responsable:</strong> {{ selectedDispatch.responsible }}</p>
          <p *ngIf="selectedDispatch.notes"><strong>Notas:</strong> {{ selectedDispatch.notes }}</p>
        </div>
      </div>
    </div>
  </div>
</div>